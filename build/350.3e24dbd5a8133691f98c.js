"use strict";(self.webpackChunkproductionproject=self.webpackChunkproductionproject||[]).push([[350],{3350:function(e,a,r){r.r(a),r.d(a,{default:function(){return Q}});var n=r(2327),t=r(9250),o=r(3007),l=r(8979),s=r(4092),i=r(7294),c=r(9319),d=r(4268);const u=(0,d.hg)("profile/fetchProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n}=a;try{const a=await r.api.get(`/profile/${e}`);if(!a.data)throw new Error;return a.data}catch(e){return console.log(e),n("Error")}})),C=e=>e?.profile?.error,m=e=>e?.profile?.isLoading,h=e=>e?.profile?.form;let f=function(e){return e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR",e}({});const g=(0,d.hg)("profile/updateProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n,getState:t}=a,o=h(t()),l=(e=>{if(!e)return[f.NO_DATA];const{first:a,lastname:r,age:n,country:t}=e,o=[];return a&&r||o.push(f.INCORRECT_USER_DATA),n&&Number.isInteger(n)||o.push(f.INCORRECT_AGE),t||o.push(f.INCORRECT_COUNTRY),o})(o);if(l.length)return n(l);try{const e=await r.api.put(`/profile/${o?.id||""}`,o);if(!e.data)throw new Error;return e.data}catch(e){return console.log(e),n([f.SERVER_ERROR])}})),p=(0,d.oM)({name:"profile",initialState:{readonly:!0,isLoading:!1,error:void 0,data:void 0},reducers:{setReadonly:(e,a)=>{e.readonly=a.payload},cancelEdit:e=>{e.readonly=!0,e.validateError=void 0,e.form=e.data},updateProfile:(e,a)=>{e.form={...e.form,...a.payload}}},extraReducers:e=>{e.addCase(u.pending,((e,a)=>{e.error=void 0,e.isLoading=!0})).addCase(u.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload})).addCase(u.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload})).addCase(g.pending,((e,a)=>{e.validateError=void 0,e.isLoading=!0})).addCase(g.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload,e.readonly=!0,e.validateError=void 0})).addCase(g.rejected,((e,a)=>{e.isLoading=!1,e.validateError=a.payload}))}}),{actions:R}=p,{reducer:v}=p,y=e=>e?.profile?.readonly,E=e=>e?.profile?.validateError;var x=r(1715),N=r(8312),j=r(379),A=r(2949);let U=function(e){return e.RUB="RUB",e.EUR="EUR",e.USD="USD",e}({});var O=r(9607),T=r(5893);const I=[{value:U.RUB,content:U.RUB},{value:U.EUR,content:U.EUR},{value:U.USD,content:U.USD}];var b=(0,i.memo)((e=>{const{className:a,value:r,onChange:t,readonly:o}=e,{t:l}=(0,n.$)("profile"),s=(0,i.useCallback)((e=>{t?.(e)}),[t]);return(0,T.jsx)(O.wb,{className:a,value:r,defaultValue:l("Choose a currency"),label:l("Choose a currency"),onChange:s,items:I,readonly:o,direction:"top right"})}));let k=function(e){return e.Russia="Russia",e.Ukraine="Ukraine",e.Armenia="Armenia",e}({});const _=[{value:k.Russia,content:k.Russia},{value:k.Ukraine,content:k.Ukraine},{value:k.Armenia,content:k.Armenia}];var S=(0,i.memo)((e=>{const{className:a,value:r,onChange:t,readonly:o}=e,{t:l}=(0,n.$)("profile"),s=(0,i.useCallback)((e=>{t?.(e)}),[t]);return(0,T.jsx)(O.wb,{className:a,value:r,defaultValue:l("Choose a country"),label:l("Choose a country"),onChange:s,items:_,readonly:o,direction:"top right"})})),P=r(2047),D={ProfileCard:"wW9jg",loading:"t07Zx",error:"i5YK3",editing:"DjTe7"};const L=e=>{const{className:a,data:r,isLoading:t,error:l,readonly:s,onChangeFirstname:i,onChangeLastname:c,onChangeCity:d,onChangeAge:u,onChangeUsername:C,onChangeAvatar:m,onChangeCountry:h,onChangeCurrency:f}=e,{t:g}=(0,n.$)("profile");if(t)return(0,T.jsx)(P.U,{justify:"center",max:!0,className:(0,o.A)(D.ProfileCard,{},[a,D.loading]),children:(0,T.jsx)(j.Z,{})});if(l)return(0,T.jsx)(P.U,{justify:"center",max:!0,className:(0,o.A)(D.ProfileCard,{},[a,D.error]),children:(0,T.jsx)(x.xv,{theme:x.lg.ERROR,title:g("Mistake is happened"),text:g("Try again"),align:x.PH.CENTER})});const p={[D.editing]:!s};return(0,T.jsxs)(P.g,{max:!0,gap:"8",className:(0,o.A)(D.ProfileCard,p,[a]),children:[r?.avatar&&(0,T.jsx)(P.U,{justify:"center",max:!0,className:D.avatarWrapper,children:(0,T.jsx)(A.q,{src:r?.avatar})}),(0,T.jsx)(N.I,{value:r?.first,placeholder:g("Your name"),className:D.input,onChange:i,readonly:s}),(0,T.jsx)(N.I,{value:r?.lastname,placeholder:g("Your surname"),className:D.input,onChange:c,readonly:s}),(0,T.jsx)(N.I,{onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},value:r?.age,placeholder:g("Age"),className:D.input,onChange:u,readonly:s}),(0,T.jsx)(N.I,{value:r?.city,placeholder:g("City"),className:D.input,onChange:d,readonly:s}),(0,T.jsx)(N.I,{value:r?.username,placeholder:g("Username"),className:D.input,onChange:C,readonly:s}),(0,T.jsx)(N.I,{value:r?.avatar,placeholder:g("Avatar"),className:D.input,onChange:m,readonly:s}),(0,T.jsx)(b,{className:D.input,value:r?.currency,onChange:f,readonly:s}),(0,T.jsx)(S,{className:D.input,value:r?.country,onChange:h,readonly:s})]})};var w=r(5401),$=r(9970),V=r(1233),Y=r(5255);const F=e=>e?.profile?.data;var M=r(3381),G=r(3363),W=(0,i.memo)((e=>{const{className:a}=e,{t:r}=(0,n.$)("profile"),t=(0,c.v9)(y),l=(0,c.v9)(M.m5),s=(0,c.v9)(F),d=(0,w.T)(),u=l?.id===s?.id,C=(0,i.useCallback)((()=>{d(R.setReadonly(!1))}),[d]),m=(0,i.useCallback)((()=>{d(R.cancelEdit())}),[d]),h=(0,i.useCallback)((()=>{d(g())}),[d]);return(0,T.jsxs)(G.U,{max:!0,justify:"between",className:(0,o.A)("",{},[a]),children:[(0,T.jsx)(x.xv,{title:r("Profile")}),u&&(0,T.jsx)(T.Fragment,{children:t?(0,T.jsx)(Y.zx,{theme:Y.bn.OUTLINE,onClick:C,children:r("Edit")}):(0,T.jsxs)(G.U,{gap:"8",children:[(0,T.jsx)(Y.zx,{theme:Y.bn.OUTLINE_RED,onClick:m,children:r("Cancel")}),(0,T.jsx)(Y.zx,{theme:Y.bn.OUTLINE,onClick:h,children:r("Save")})]})})]})}));const B={profile:v},z=(0,i.memo)((e=>{const{className:a,id:r}=e,{t:t,i18n:l}=(0,n.$)("profile"),s=(0,w.T)(),d=(0,c.v9)(h),g=(0,c.v9)(m),p=(0,c.v9)(C),v=(0,c.v9)(y),N=(0,c.v9)(E),j={[f.SERVER_ERROR]:t("Server error"),[f.NO_DATA]:t("Data is absented"),[f.INCORRECT_USER_DATA]:t("Incorrect user data"),[f.INCORRECT_COUNTRY]:t("Incorrect country"),[f.INCORRECT_AGE]:t("Incorrect age")};(0,$.Q)((()=>{r&&s(u(r))}));const A=(0,i.useCallback)((e=>{s(R.updateProfile({first:e||""}))}),[s]),U=(0,i.useCallback)((e=>{s(R.updateProfile({lastname:e||""}))}),[s]),O=(0,i.useCallback)((e=>{s(R.updateProfile({age:Number(e||0)}))}),[s]),I=(0,i.useCallback)((e=>{s(R.updateProfile({city:e||""}))}),[s]),b=(0,i.useCallback)((e=>{s(R.updateProfile({username:e||""}))}),[s]),k=(0,i.useCallback)((e=>{s(R.updateProfile({avatar:e||""}))}),[s]),_=(0,i.useCallback)((e=>{s(R.updateProfile({currency:e}))}),[s]),S=(0,i.useCallback)((e=>{s(R.updateProfile({country:e}))}),[s]);return(0,T.jsx)(V.W,{reducers:B,removeAfterUnmount:!0,children:(0,T.jsxs)(P.g,{gap:"8",max:!0,className:(0,o.A)("",{},[a]),children:[(0,T.jsx)(W,{}),N?.length&&N.map((e=>(0,T.jsx)(x.xv,{theme:x.lg.ERROR,text:j[e]},e))),(0,T.jsx)(L,{data:d,isLoading:g,error:p,onChangeFirstname:A,onChangeLastname:U,onChangeAge:O,onChangeCity:I,onChangeUsername:b,onChangeAvatar:k,onChangeCurrency:_,onChangeCountry:S,readonly:v})]})})}));var Q=e=>{let{className:a}=e;const{t:r,i18n:i}=(0,n.$)("profile"),{id:c}=(0,t.UO)();return(0,T.jsx)(l.Z,{className:(0,o.A)("",{},[a]),children:(0,T.jsx)(s.g,{max:!0,gap:"16",children:(0,T.jsx)(z,{id:c})})})}},1233:function(e,a,r){r.d(a,{W:function(){return l}});var n=r(7294),t=r(9319),o=r(5893);const l=e=>{const{children:a,reducers:r,removeAfterUnmount:l}=e,s=(0,t.oR)(),i=(0,t.I0)();return(0,n.useEffect)((()=>{const e=s.reducerManager.getMountedReducers();return Object.entries(r).forEach((a=>{let[r,n]=a;e[r]||(s.reducerManager.add(r,n),i({type:`@INIT ${r} reducer`}))})),()=>{l&&Object.entries(r).forEach((e=>{let[a,r]=e;s.reducerManager.remove(a),i({type:`@DESTROY ${a} reducer`})}))}}),[]),(0,o.jsx)(o.Fragment,{children:a})}},8312:function(e,a,r){r.d(a,{I:function(){return l}});var n=r(3007),t=r(7294),o=r(5893);const l=(0,t.memo)((e=>{const{className:a,value:r,onChange:l,type:s="text",placeholder:i,autofocus:c,readonly:d,...u}=e,[C,m]=(0,t.useState)(!1),[h,f]=(0,t.useState)(0),g=(0,t.useRef)(null),p=C&&!d;return(0,t.useEffect)((()=>{c&&(m(!0),g.current?.focus())}),[c]),(0,o.jsxs)("div",{className:(0,n.A)("yiPAS",{},[a]),children:[i&&(0,o.jsx)("div",{className:"emAQQ",children:`${i}>`}),(0,o.jsxs)("div",{className:"y1GiF",children:[(0,o.jsx)("input",{ref:g,type:s,value:r,onChange:e=>{l?.(e.target.value),f(e.target.value.length)},className:"LVdIP",onFocus:()=>{m(!0)},onBlur:()=>{m(!1)},onSelect:e=>{f(e?.target?.selectionStart||0)},readOnly:d,...u}),p&&(0,o.jsx)("span",{className:"lqMFG",style:{left:9*h+"px"}})]})]})}))}}]);